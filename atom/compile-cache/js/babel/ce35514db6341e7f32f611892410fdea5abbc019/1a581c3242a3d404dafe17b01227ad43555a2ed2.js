function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

/* eslint-env jasmine */

var _temp = require('temp');

var _temp2 = _interopRequireDefault(_temp);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _fsPlus = require('fs-plus');

var _fsPlus2 = _interopRequireDefault(_fsPlus);

'use babel';

describe('gorename', function () {
  _temp2['default'].track();
  var mainModule = null;
  var gorename = null;
  var editor = null;
  var gopath = null;
  var oldGopath = null;
  var source = null;
  var target = null;

  beforeEach(function () {
    runs(function () {
      if (process.env.GOPATH) {
        oldGopath = process.env.GOPATH;
      }
      gopath = _fsPlus2['default'].realpathSync(_temp2['default'].mkdirSync('gopath-'));
      process.env.GOPATH = gopath;
    });

    waitsForPromise(function () {
      return atom.packages.activatePackage('environment').then(function () {
        return atom.packages.activatePackage('go-config');
      }).then(function () {
        return atom.packages.activatePackage('gorename');
      }).then(function (pack) {
        mainModule = pack.mainModule;
        gorename = mainModule.gorename;
        return;
      });
    });

    waitsFor(function () {
      return mainModule.getGoconfig() !== false;
    });
  });

  afterEach(function () {
    if (oldGopath) {
      process.env.GOPATH = oldGopath;
    } else {
      delete process.env.GOPATH;
    }
  });

  describe('when a simple file is open', function () {
    beforeEach(function () {
      runs(function () {
        source = _path2['default'].join(__dirname, 'fixtures', 'basic');
        target = _path2['default'].join(gopath, 'src', 'basic');
        _fsPlus2['default'].copySync(source, target);
      });

      waitsForPromise(function () {
        return atom.workspace.open(_path2['default'].join(target, 'main.go')).then(function (e) {
          editor = e;
          return;
        });
      });
    });

    it('renames a single token', function () {
      editor.setCursorBufferPosition([4, 5]);
      var info = gorename.wordAndOffset(editor);
      expect(info.word).toBe('foo');
      expect(info.offset).toBe(33);

      var file = editor.getBuffer().getPath();
      var cwd = _path2['default'].dirname(file);
      var r = false;
      var cmd = undefined;
      waitsForPromise(function () {
        return mainModule.getGoconfig().locator.findTool('gorename').then(function (c) {
          expect(c).toBeTruthy();
          cmd = c;
        });
      });
      waitsForPromise(function () {
        return gorename.runGorename(file, info.offset, cwd, 'bar', cmd).then(function (result) {
          r = result;
          return;
        });
      });
      runs(function () {
        expect(r).toBeTruthy();
        expect(r.success).toBe(true);
        expect(r.result.stdout.trim()).toBe('Renamed 2 occurrences in 1 file in 1 package.');
        var expected = _fsPlus2['default'].readFileSync(_path2['default'].join(__dirname, 'fixtures', 'basic-expected', 'main.go'), 'utf8');
        var actual = editor.getText();
        expect(actual).toBe(expected);
      });
    });
  });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9zc3VuLy5hdG9tL3BhY2thZ2VzL2dvcmVuYW1lL3NwZWMvZ29yZW5hbWUtc3BlYy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O29CQUdpQixNQUFNOzs7O29CQUNOLE1BQU07Ozs7c0JBQ1IsU0FBUzs7OztBQUx4QixXQUFXLENBQUE7O0FBT1gsUUFBUSxDQUFDLFVBQVUsRUFBRSxZQUFNO0FBQ3pCLG9CQUFLLEtBQUssRUFBRSxDQUFBO0FBQ1osTUFBSSxVQUFVLEdBQUcsSUFBSSxDQUFBO0FBQ3JCLE1BQUksUUFBUSxHQUFHLElBQUksQ0FBQTtBQUNuQixNQUFJLE1BQU0sR0FBRyxJQUFJLENBQUE7QUFDakIsTUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFBO0FBQ2pCLE1BQUksU0FBUyxHQUFHLElBQUksQ0FBQTtBQUNwQixNQUFJLE1BQU0sR0FBRyxJQUFJLENBQUE7QUFDakIsTUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFBOztBQUVqQixZQUFVLENBQUMsWUFBTTtBQUNmLFFBQUksQ0FBQyxZQUFNO0FBQ1QsVUFBSSxPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRTtBQUN0QixpQkFBUyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFBO09BQy9CO0FBQ0QsWUFBTSxHQUFHLG9CQUFHLFlBQVksQ0FBQyxrQkFBSyxTQUFTLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQTtBQUNuRCxhQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUE7S0FDNUIsQ0FBQyxDQUFBOztBQUVGLG1CQUFlLENBQUMsWUFBTTtBQUNwQixhQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsZUFBZSxDQUFDLGFBQWEsQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFNO0FBQzdELGVBQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxlQUFlLENBQUMsV0FBVyxDQUFDLENBQUE7T0FDbEQsQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFNO0FBQ1osZUFBTyxJ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Q0FBQyxDQUFBO09BQ0gsQ0FBQyxDQUFBO0FBQ0YsVUFBSSxDQUFDLFlBQU07QUFDVCxjQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsVUFBVSxFQUFFLENBQUE7QUFDdEIsY0FBTSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUE7QUFDNUIsY0FBTSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLCtDQUErQyxDQUFDLENBQUE7QUFDcEYsWUFBSSxRQUFRLEdBQUcsb0JBQUcsWUFBWSxDQUFDLGtCQUFLLElBQUksQ0FBQyxTQUFTLEVBQUUsVUFBVSxFQUFFLGdCQUFnQixFQUFFLFNBQVMsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFBO0FBQ3JHLFlBQUksTUFBTSxHQUFHLE1BQU0sQ0FBQyxPQUFPLEVBQUUsQ0FBQTtBQUM3QixjQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFBO09BQzlCLENBQUMsQ0FBQTtLQUNILENBQUMsQ0FBQTtHQUNILENBQUMsQ0FBQTtDQUNILENBQUMsQ0FBQSIsImZpbGUiOiIvVXNlcnMvc3N1bi8uYXRvbS9wYWNrYWdlcy9nb3JlbmFtZS9zcGVjL2dvcmVuYW1lLXNwZWMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIGJhYmVsJ1xuLyogZXNsaW50LWVudiBqYXNtaW5lICovXG5cbmltcG9ydCB0ZW1wIGZyb20gJ3RlbXAnXG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJ1xuaW1wb3J0IGZzIGZyb20gJ2ZzLXBsdXMnXG5cbmRlc2NyaWJlKCdnb3JlbmFtZScsICgpID0+IHtcbiAgdGVtcC50cmFjaygpXG4gIGxldCBtYWluTW9kdWxlID0gbnVsbFxuICBsZXQgZ29yZW5hbWUgPSBudWxsXG4gIGxldCBlZGl0b3IgPSBudWxsXG4gIGxldCBnb3BhdGggPSBudWxsXG4gIGxldCBvbGRHb3BhdGggPSBudWxsXG4gIGxldCBzb3VyY2UgPSBudWxsXG4gIGxldCB0YXJnZXQgPSBudWxsXG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgcnVucygoKSA9PiB7XG4gICAgICBpZiAocHJvY2Vzcy5lbnYuR09QQVRIKSB7XG4gICAgICAgIG9sZEdvcGF0aCA9IHByb2Nlc3MuZW52LkdPUEFUSFxuICAgICAgfVxuICAgICAgZ29wYXRoID0gZnMucmVhbHBhdGhTeW5jKHRlbXAubWtkaXJTeW5jKCdnb3BhdGgtJykpXG4gICAgICBwcm9jZXNzLmVudi5HT1BBVEggPSBnb3BhdGhcbiAgICB9KVxuXG4gICAgd2FpdHNGb3JQcm9taXNlKCgpID0+IHtcbiAgICAgIHJldHVybiBhdG9tLnBhY2thZ2VzLmFjdGl2YXRlUGFja2FnZSgnZW52aXJvbm1lbnQnKS50aGVuKCgpID0+IHtcbiAgICAgICAgcmV0dXJuIGF0b20ucGFja2FnZXMuYWN0aXZhdGVQYWNrYWdlKCdnby1jb25maWcnKVxuICAgICAgfSkudGhlbigoKSA9PiB7XG4gICAgICAgIHJldHVybiBhdG9tLnBhY2thZ2VzLmFjdGl2YXRlUGFja2FnZSgnZ29yZW5hbWUnKVxuICAgICAgfSkudGhlbigocGFjaykgPT4ge1xuICAgICAgICBtYWluTW9kdWxlID0gcGFjay5tYWluTW9kdWxlXG4gICAgICAgIGdvcmVuYW1lID0gbWFpbk1vZHVsZS5nb3JlbmFtZVxuICAgICAgICByZXR1cm5cbiAgICAgIH0pXG4gICAgfSlcblxuICAgIHdhaXRzRm9yKCgpID0+IHtcbiAgICAgIHJldHVybiBtYWluTW9kdWxlLmdldEdvY29uZmlnKCkgIT09IGZhbHNlXG4gICAgfSlcbiAgfSlcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGlmIChvbGRHb3BhdGgpIHtcbiAgICAgIHByb2Nlc3MuZW52LkdPUEFUSCA9IG9sZEdvcGF0aFxuICAgIH0gZWxzZSB7XG4gICAgICBkZWxldGUgcHJvY2Vzcy5lbnYuR09QQVRIXG4gICAgfVxuICB9KVxuXG4gIGRlc2NyaWJlKCd3aGVuIGEgc2ltcGxlIGZpbGUgaXMgb3BlbicsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIHJ1bnMoKCkgPT4ge1xuICAgICAgICBzb3VyY2UgPSBwYXRoLmpvaW4oX19kaXJuYW1lLCAnZml4dHVyZXMnLCAnYmFzaWMnKVxuICAgICAgICB0YXJnZXQgPSBwYXRoLmpvaW4oZ29wYXRoLCAnc3JjJywgJ2Jhc2ljJylcbiAgICAgICAgZnMuY29weVN5bmMoc291cmNlLCB0YXJnZXQpXG4gICAgICB9KVxuXG4gICAgICB3YWl0c0ZvclByb21pc2UoKCkgPT4ge1xuICAgICAgICByZXR1cm4gYXRvbS53b3Jrc3BhY2Uub3BlbihwYXRoLmpvaW4odGFyZ2V0LCAnbWFpbi5nbycpKS50aGVuKChlKSA9PiB7XG4gICAgICAgICAgZWRpdG9yID0gZVxuICAgICAgICAgIHJldHVyblxuICAgICAgICB9KVxuICAgICAgfSlcbiAgICB9KVxuXG4gICAgaXQoJ3JlbmFtZXMgYSBzaW5nbGUgdG9rZW4nLCAoKSA9PiB7XG4gICAgICBlZGl0b3Iuc2V0Q3Vyc29yQnVmZmVyUG9zaXRpb24oWzQsIDVdKVxuICAgICAgbGV0IGluZm8gPSBnb3JlbmFtZS53b3JkQW5kT2Zmc2V0KGVkaXRvcilcbiAgICAgIGV4cGVjdChpbmZvLndvcmQpLnRvQmUoJ2ZvbycpXG4gICAgICBleHBlY3QoaW5mby5vZmZzZXQpLnRvQmUoMzMpXG5cbiAgICAgIGxldCBmaWxlID0gZWRpdG9yLmdldEJ1ZmZlcigpLmdldFBhdGgoKVxuICAgICAgbGV0IGN3ZCA9IHBhdGguZGlybmFtZShmaWxlKVxuICAgICAgbGV0IHIgPSBmYWxzZVxuICAgICAgbGV0IGNtZFxuICAgICAgd2FpdHNGb3JQcm9taXNlKCgpID0+IHtcbiAgICAgICAgcmV0dXJuIG1haW5Nb2R1bGUuZ2V0R29jb25maWcoKS5sb2NhdG9yLmZpbmRUb29sKCdnb3JlbmFtZScpLnRoZW4oKGMpID0+IHtcbiAgICAgICAgICBleHBlY3QoYykudG9CZVRydXRoeSgpXG4gICAgICAgICAgY21kID0gY1xuICAgICAgICB9KVxuICAgICAgfSlcbiAgICAgIHdhaXRzRm9yUHJvbWlzZSgoKSA9PiB7XG4gICAgICAgIHJldHVybiBnb3JlbmFtZS5ydW5Hb3JlbmFtZShmaWxlLCBpbmZvLm9mZnNldCwgY3dkLCAnYmFyJywgY21kKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICByID0gcmVzdWx0XG4gICAgICAgICAgcmV0dXJuXG4gICAgICAgIH0pXG4gICAgICB9KVxuICAgICAgcnVucygoKSA9PiB7XG4gICAgICAgIGV4cGVjdChyKS50b0JlVHJ1dGh5KClcbiAgICAgICAgZXhwZWN0KHIuc3VjY2VzcykudG9CZSh0cnVlKVxuICAgICAgICBleHBlY3Qoci5yZXN1bHQuc3Rkb3V0LnRyaW0oKSkudG9CZSgnUmVuYW1lZCAyIG9jY3VycmVuY2VzIGluIDEgZmlsZSBpbiAxIHBhY2thZ2UuJylcbiAgICAgICAgbGV0IGV4cGVjdGVkID0gZnMucmVhZEZpbGVTeW5jKHBhdGguam9pbihfX2Rpcm5hbWUsICdmaXh0dXJlcycsICdiYXNpYy1leHBlY3RlZCcsICdtYWluLmdvJyksICd1dGY4JylcbiAgICAgICAgbGV0IGFjdHVhbCA9IGVkaXRvci5nZXRUZXh0KClcbiAgICAgICAgZXhwZWN0KGFjdHVhbCkudG9CZShleHBlY3RlZClcbiAgICAgIH0pXG4gICAgfSlcbiAgfSlcbn0pXG4iXX0=
//# sourceURL=/Users/ssun/.atom/packages/gorename/spec/gorename-spec.js
