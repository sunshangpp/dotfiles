function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

/* eslint-env jasmine */

var _temp = require('temp');

var _temp2 = _interopRequireDefault(_temp);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _fsPlus = require('fs-plus');

var _fsPlus2 = _interopRequireDefault(_fsPlus);

'use babel';

describe('godoc', function () {
  _temp2['default'].track();
  var mainModule = null;
  var godoc = null;
  var editor = null;
  var gopath = null;
  var oldGopath = null;
  var source = null;
  var target = null;

  beforeEach(function () {
    runs(function () {
      if (process.env.GOPATH) {
        oldGopath = process.env.GOPATH;
      }
      gopath = _fsPlus2['default'].realpathSync(_temp2['default'].mkdirSync('gopath-'));
      process.env.GOPATH = gopath;
    });

    waitsForPromise(function () {
      return atom.packages.activatePackage('language-go').then(function () {
        return atom.packages.activatePackage('go-config').then(function () {
          return atom.packages.activatePackage('godoc').then(function (pack) {
            mainModule = pack.mainModule;
            godoc = mainModule.godoc;
            return;
          });
        });
      });
    });

    waitsFor(function () {
      return mainModule.getGoconfig() !== false;
    });
  });

  afterEach(function () {
    if (oldGopath) {
      process.env.GOPATH = oldGopath;
    } else {
      delete process.env.GOPATH;
    }
  });

  describe('when the godoc command is invoked on a valid go file', function () {
    beforeEach(function () {
      runs(function () {
        source = _path2['default'].join(__dirname, 'fixtures');
        target = _path2['default'].join(gopath, 'src', 'godoctest');
        _fsPlus2['default'].copySync(source, target);
      });

      waitsForPromise(function () {
        return atom.workspace.open(_path2['default'].join(target, 'main.go')).then(function (e) {
          editor = e;
          return;
        });
      });
    });

    it('shows/hides the view correctly', function () {
      var view = atom.views.getView(editor);
      editor.setCursorBufferPosition([25, 10]);
      expect(godoc.marker).toBeFalsy();
      var result = false;
      waitsForPromise(function () {
        return godoc.commandInvoked().then(function (r) {
          result = r;
          return;
        });
      });
      runs(function () {
        expect(godoc.marker).toBeTruthy();
        var viewPresent = function viewPresent() {
          return view.classList.contains('godoc-display-active') || view.classList.contains('godoc-in-progress');
        };
        expect(result).toBeTruthy();
        expect(viewPresent()).toBe(true);
        atom.commands.dispatch(view, 'godoc:hide');
        expect(godoc.marker).toBeFalsy();
        expect(viewPresent()).toBe(false);
      });
    });

    it('gets the correct documentation', function () {
      var result = false;
      editor.setCursorBufferPosition([24, 10]);
      waitsForPromise(function () {
        return godoc.commandInvoked().then(function (r) {
          result = r;
        });
      });
      runs(function () {
        expect(result).toBeTruthy();
        expect(result.success).toBe(true);
        expect(result.result.exitcode).toBe(0);
      });
    });
  });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9zc3VuLy5hdG9tL3BhY2thZ2VzL2dvZG9jL3NwZWMvZ29kb2Mtc3BlYy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O29CQUdpQixNQUFNOzs7O29CQUNOLE1BQU07Ozs7c0JBQ1IsU0FBUzs7OztBQUx4QixXQUFXLENBQUE7O0FBT1gsUUFBUSxDQUFDLE9BQU8sRUFBRSxZQUFNO0FBQ3RCLG9CQUFLLEtBQUssRUFBRSxDQUFBO0FBQ1osTUFBSSxVQUFVLEdBQUcsSUFBSSxDQUFBO0FBQ3JCLE1BQUksS0FBSyxHQUFHLElBQUksQ0FBQTtBQUNoQixNQUFJLE1BQU0sR0FBRyxJQUFJLENBQUE7QUFDakIsTUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFBO0FBQ2pCLE1BQUksU0FBUyxHQUFHLElBQUksQ0FBQTtBQUNwQixNQUFJLE1BQU0sR0FBRyxJQUFJLENBQUE7QUFDakIsTUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFBOztBQUVqQixZQUFVLENBQUMsWUFBTTtBQUNmLFFBQUksQ0FBQyxZQUFNO0FBQ1QsVUFBSSxPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRTtBQUN0QixpQkFBUyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFBO09BQy9CO0FBQ0QsWUFBTSxHQUFHLG9CQUFHLFlBQVksQ0FBQyxrQkFBSyxTQUFTLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQTtBQUNuRCxhQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUE7S0FDNUIsQ0FBQyxDQUFBOztBQUVGLG1CQUFlLENBQUMsWUFBTTtBQUNwQixhQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsZUFBZSxDQUFDLGFBQWEsQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFNO0FBQzdELGVBQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxlQUFlLENBQUMsV0FBVyxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQU07QUFDM0QsaUJBQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxl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RUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFBO09BQ2xDLENBQUMsQ0FBQTtLQUNILENBQUMsQ0FBQTs7QUFFRixNQUFFLENBQUMsZ0NBQWdDLEVBQUUsWUFBTTtBQUN6QyxVQUFJLE1BQU0sR0FBRyxLQUFLLENBQUE7QUFDbEIsWUFBTSxDQUFDLHVCQUF1QixDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUE7QUFDeEMscUJBQWUsQ0FBQyxZQUFNO0FBQ3BCLGVBQU8sS0FBSyxDQUFDLGNBQWMsRUFBRSxDQUFDLElBQUksQ0FBQyxVQUFDLENBQUMsRUFBSztBQUN4QyxnQkFBTSxHQUFHLENBQUMsQ0FBQTtTQUNYLENBQUMsQ0FBQTtPQUNILENBQUMsQ0FBQTtBQUNGLFVBQUksQ0FBQyxZQUFNO0FBQ1QsY0FBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLFVBQVUsRUFBRSxDQUFBO0FBQzNCLGNBQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFBO0FBQ2pDLGNBQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQTtPQUN2QyxDQUFDLENBQUE7S0FDSCxDQUFDLENBQUE7R0FDSCxDQUFDLENBQUE7Q0FDSCxDQUFDLENBQUEiLCJmaWxlIjoiL1VzZXJzL3NzdW4vLmF0b20vcGFja2FnZXMvZ29kb2Mvc3BlYy9nb2RvYy1zcGVjLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBiYWJlbCdcbi8qIGVzbGludC1lbnYgamFzbWluZSAqL1xuXG5pbXBvcnQgdGVtcCBmcm9tICd0ZW1wJ1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCdcbmltcG9ydCBmcyBmcm9tICdmcy1wbHVzJ1xuXG5kZXNjcmliZSgnZ29kb2MnLCAoKSA9PiB7XG4gIHRlbXAudHJhY2soKVxuICBsZXQgbWFpbk1vZHVsZSA9IG51bGxcbiAgbGV0IGdvZG9jID0gbnVsbFxuICBsZXQgZWRpdG9yID0gbnVsbFxuICBsZXQgZ29wYXRoID0gbnVsbFxuICBsZXQgb2xkR29wYXRoID0gbnVsbFxuICBsZXQgc291cmNlID0gbnVsbFxuICBsZXQgdGFyZ2V0ID0gbnVsbFxuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIHJ1bnMoKCkgPT4ge1xuICAgICAgaWYgKHByb2Nlc3MuZW52LkdPUEFUSCkge1xuICAgICAgICBvbGRHb3BhdGggPSBwcm9jZXNzLmVudi5HT1BBVEhcbiAgICAgIH1cbiAgICAgIGdvcGF0aCA9IGZzLnJlYWxwYXRoU3luYyh0ZW1wLm1rZGlyU3luYygnZ29wYXRoLScpKVxuICAgICAgcHJvY2Vzcy5lbnYuR09QQVRIID0gZ29wYXRoXG4gICAgfSlcblxuICAgIHdhaXRzRm9yUHJvbWlzZSgoKSA9PiB7XG4gICAgICByZXR1cm4gYXRvbS5wYWNrYWdlcy5hY3RpdmF0ZVBhY2thZ2UoJ2xhbmd1YWdlLWdvJykudGhlbigoKSA9PiB7XG4gICAgICAgIHJldHVybiBhdG9tLnBhY2thZ2VzLmFjdGl2YXRlUGFja2FnZSgnZ28tY29uZmlnJykudGhlbigoKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGF0b20ucGFja2FnZXMuYWN0aXZhdGVQYWNrYWdlKCdnb2RvYycpLnRoZW4oKHBhY2spID0+IHtcbiAgICAgICAgICAgIG1haW5Nb2R1bGUgPSBwYWNrLm1haW5Nb2R1bGVcbiAgICAgICAgICAgIGdvZG9jID0gbWFpbk1vZHVsZS5nb2RvY1xuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICAgIH0pXG4gICAgfSlcblxuICAgIHdhaXRzRm9yKCgpID0+IHtcbiAgICAgIHJldHVybiBtYWluTW9kdWxlLmdldEdvY29uZmlnKCkgIT09IGZhbHNlXG4gICAgfSlcbiAgfSlcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGlmIChvbGRHb3BhdGgpIHtcbiAgICAgIHByb2Nlc3MuZW52LkdPUEFUSCA9IG9sZEdvcGF0aFxuICAgIH0gZWxzZSB7XG4gICAgICBkZWxldGUgcHJvY2Vzcy5lbnYuR09QQVRIXG4gICAgfVxuICB9KVxuXG4gIGRlc2NyaWJlKCd3aGVuIHRoZSBnb2RvYyBjb21tYW5kIGlzIGludm9rZWQgb24gYSB2YWxpZCBnbyBmaWxlJywgKCkgPT4ge1xuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgcnVucygoKSA9PiB7XG4gICAgICAgIHNvdXJjZSA9IHBhdGguam9pbihfX2Rpcm5hbWUsICdmaXh0dXJlcycpXG4gICAgICAgIHRhcmdldCA9IHBhdGguam9pbihnb3BhdGgsICdzcmMnLCAnZ29kb2N0ZXN0JylcbiAgICAgICAgZnMuY29weVN5bmMoc291cmNlLCB0YXJnZXQpXG4gICAgICB9KVxuXG4gICAgICB3YWl0c0ZvclByb21pc2UoKCkgPT4ge1xuICAgICAgICByZXR1cm4gYXRvbS53b3Jrc3BhY2Uub3BlbihwYXRoLmpvaW4odGFyZ2V0LCAnbWFpbi5nbycpKS50aGVuKChlKSA9PiB7XG4gICAgICAgICAgZWRpdG9yID0gZVxuICAgICAgICAgIHJldHVyblxuICAgICAgICB9KVxuICAgICAgfSlcbiAgICB9KVxuXG4gICAgaXQoJ3Nob3dzL2hpZGVzIHRoZSB2aWV3IGNvcnJlY3RseScsICgpID0+IHtcbiAgICAgIGxldCB2aWV3ID0gYXRvbS52aWV3cy5nZXRWaWV3KGVkaXRvcilcbiAgICAgIGVkaXRvci5zZXRDdXJzb3JCdWZmZXJQb3NpdGlvbihbMjUsIDEwXSlcbiAgICAgIGV4cGVjdChnb2RvYy5tYXJrZXIpLnRvQmVGYWxzeSgpXG4gICAgICBsZXQgcmVzdWx0ID0gZmFsc2VcbiAgICAgIHdhaXRzRm9yUHJvbWlzZSgoKSA9PiB7XG4gICAgICAgIHJldHVybiBnb2RvYy5jb21tYW5kSW52b2tlZCgpLnRoZW4oKHIpID0+IHtcbiAgICAgICAgICByZXN1bHQgPSByXG4gICAgICAgICAgcmV0dXJuXG4gICAgICAgIH0pXG4gICAgICB9KVxuICAgICAgcnVucygoKSA9PiB7XG4gICAgICAgIGV4cGVjdChnb2RvYy5tYXJrZXIpLnRvQmVUcnV0aHkoKVxuICAgICAgICBsZXQgdmlld1ByZXNlbnQgPSAoKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIHZpZXcuY2xhc3NMaXN0LmNvbnRhaW5zKCdnb2RvYy1kaXNwbGF5LWFjdGl2ZScpIHx8XG4gICAgICAgICAgICB2aWV3LmNsYXNzTGlzdC5jb250YWlucygnZ29kb2MtaW4tcHJvZ3Jlc3MnKVxuICAgICAgICB9XG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVUcnV0aHkoKVxuICAgICAgICBleHBlY3Qodmlld1ByZXNlbnQoKSkudG9CZSh0cnVlKVxuICAgICAgICBhdG9tLmNvbW1hbmRzLmRpc3BhdGNoKHZpZXcsICdnb2RvYzpoaWRlJylcbiAgICAgICAgZXhwZWN0KGdvZG9jLm1hcmtlcikudG9CZUZhbHN5KClcbiAgICAgICAgZXhwZWN0KHZpZXdQcmVzZW50KCkpLnRvQmUoZmFsc2UpXG4gICAgICB9KVxuICAgIH0pXG5cbiAgICBpdCgnZ2V0cyB0aGUgY29ycmVjdCBkb2N1bWVudGF0aW9uJywgKCkgPT4ge1xuICAgICAgbGV0IHJlc3VsdCA9IGZhbHNlXG4gICAgICBlZGl0b3Iuc2V0Q3Vyc29yQnVmZmVyUG9zaXRpb24oWzI0LCAxMF0pXG4gICAgICB3YWl0c0ZvclByb21pc2UoKCkgPT4ge1xuICAgICAgICByZXR1cm4gZ29kb2MuY29tbWFuZEludm9rZWQoKS50aGVuKChyKSA9PiB7XG4gICAgICAgICAgcmVzdWx0ID0gclxuICAgICAgICB9KVxuICAgICAgfSlcbiAgICAgIHJ1bnMoKCkgPT4ge1xuICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlVHJ1dGh5KClcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpXG4gICAgICAgIGV4cGVjdChyZXN1bHQucmVzdWx0LmV4aXRjb2RlKS50b0JlKDApXG4gICAgICB9KVxuICAgIH0pXG4gIH0pXG59KVxuIl19
//# sourceURL=/Users/ssun/.atom/packages/godoc/spec/godoc-spec.js
