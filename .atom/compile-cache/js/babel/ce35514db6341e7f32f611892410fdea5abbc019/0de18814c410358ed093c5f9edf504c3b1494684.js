function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

/* eslint-env jasmine */

var _child_process = require('child_process');

var _child_process2 = _interopRequireDefault(_child_process);

var _libEnvironmentHelpers = require('../lib/environment-helpers');

var _libEnvironmentHelpers2 = _interopRequireDefault(_libEnvironmentHelpers);

var _os = require('os');

var _os2 = _interopRequireDefault(_os);

'use babel';

describe('Environment handling', function () {
  var originalEnv = undefined;
  var options = undefined;

  beforeEach(function () {
    originalEnv = process.env;
    delete process._originalEnv;
    options = {
      platform: process.platform,
      env: Object.assign({}, process.env)
    };
  });

  afterEach(function () {
    process.env = originalEnv;
    delete process._originalEnv;
  });

  describe('on OSX, when PWD is not set', function () {
    beforeEach(function () {
      options.platform = 'darwin';
    });

    describe('needsPatching', function () {
      it('returns true if PWD is unset', function () {
        delete options.env.PWD;
        expect(_libEnvironmentHelpers2['default'].needsPatching(options)).toBe(true);
        options.env.PWD = undefined;
        expect(_libEnvironmentHelpers2['default'].needsPatching(options)).toBe(true);
        options.env.PWD = null;
        expect(_libEnvironmentHelpers2['default'].needsPatching(options)).toBe(true);
        options.env.PWD = false;
        expect(_libEnvironmentHelpers2['default'].needsPatching(options)).toBe(true);
      });

      it('returns false if PWD is set', function () {
        options.env.PWD = 'xterm';
        expect(_libEnvironmentHelpers2['default'].needsPatching(options)).toBe(false);
      });
    });

    describe('normalize', function () {
      it('changes process.env if PWD is unset', function () {
        if (process.platform === 'win32') {
          return;
        }
        delete options.env.PWD;
        _libEnvironmentHelpers2['default'].normalize(options);
        expect(process._originalEnv).toBeDefined();
        expect(process._originalEnv).toBeTruthy();
        expect(process.env).toBeDefined();
        expect(process.env).toBeTruthy();
        expect(process.env.PWD).toBeDefined();
        expect(process.env.PWD).toBeTruthy();
        expect(process.env.PATH).toBeDefined();
        expect(process.env.PATH).toBeTruthy();
        expect(process.env.ATOM_HOME).toBeDefined();
        expect(process.env.ATOM_HOME).toBeTruthy();
      });
    });
  });

  describe('on a platform other than OSX', function () {
    beforeEach(function () {
      options.platform = 'penguin';
    });

    describe('needsPatching', function () {
      it('returns false if PWD is set or unset', function () {
        delete options.env.PWD;
        expect(_libEnvironmentHelpers2['default'].needsPatching(options)).toBe(false);
        options.env.PWD = undefined;
        expect(_libEnvironmentHelpers2['default'].needsPatching(options)).toBe(false);
        options.env.PWD = null;
        expect(_libEnvironmentHelpers2['default'].needsPatching(options)).toBe(false);
        options.env.PWD = false;
        expect(_libEnvironmentHelpers2['default'].needsPatching(options)).toBe(false);
        options.env.PWD = '/';
        expect(_libEnvironmentHelpers2['default'].needsPatching(options)).toBe(false);
      });

      it('returns false for linux', function () {
        options.platform = 'linux';
        options.PWD = '/';
        expect(_libEnvironmentHelpers2['default'].needsPatching(options)).toBe(false);
      });

      it('returns false for windows', function () {
        options.platform = 'win32';
        options.PWD = 'c:\\';
        expect(_libEnvironmentHelpers2['default'].needsPatching(options)).toBe(false);
      });
    });

    describe('normalize', function () {
      it('does not change the environment', function () {
        if (process.platform === 'win32') {
          return;
        }
        delete options.env.PWD;
        _libEnvironmentHelpers2['default'].normalize(options);
        expect(process._originalEnv).toBeUndefined();
        expect(process.env).toBeDefined();
        expect(process.env).toBeTruthy();
        expect(process.env.PATH).toBeDefined();
        expect(process.env.PATH).toBeTruthy();
        expect(process.env.PWD).toBeUndefined();
        expect(process.env.PATH).toBe(originalEnv.PATH);
        expect(process.env.ATOM_HOME).toBeDefined();
        expect(process.env.ATOM_HOME).toBeTruthy();
      });
    });
  });

  describe('getFromShell', function () {
    describe('when things are configured properly', function () {
      beforeEach(function () {
        spyOn(_child_process2['default'], 'spawnSync').andReturn({
          stdout: 'FOO=BAR' + _os2['default'].EOL + 'TERM=xterm-something' + _os2['default'].EOL + 'PATH=/usr/bin:/bin:/usr/sbin:/sbin:/crazy/path'
        });
      });

      it('returns an object containing the information from the user\'s shell environment', function () {
        var env = _libEnvironmentHelpers2['default'].getFromShell();
        expect(env.FOO).toEqual('BAR');
        expect(env.TERM).toEqual('xterm-something');
        expect(env.PATH).toEqual('/usr/bin:/bin:/usr/sbin:/sbin:/crazy/path');
      });
    });

    describe('when an error occurs launching the shell', function () {
      beforeEach(function () {
        spyOn(_child_process2['default'], 'spawnSync').andReturn({
          error: new Error('testing when an error occurs')
        });
      });

      it('returns undefined', function () {
        expect(_libEnvironmentHelpers2['default'].getFromShell()).toBeUndefined();
      });

      it('leaves the environment as-is when normalize() is called', function () {
        options.platform = 'darwin';
        delete options.env.PWD;
        expect(_libEnvironmentHelpers2['default'].needsPatching(options)).toBe(true);
        _libEnvironmentHelpers2['default'].normalize(options);
        expect(process.env).toBeDefined();
        expect(process._originalEnv).toBeUndefined();
      });
    });
  });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9zc3VuLy5hdG9tL3BhY2thZ2VzL2Vudmlyb25tZW50L3NwZWMvZW52aXJvbm1lbnQtaGVscGVycy1zcGVjLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7NkJBRzBCLGVBQWU7Ozs7cUNBQ1YsNEJBQTRCOzs7O2tCQUM1QyxJQUFJOzs7O0FBTG5CLFdBQVcsQ0FBQTs7QUFPWCxRQUFRLENBQUMsc0JBQXNCLEVBQUUsWUFBTTtBQUNyQyxNQUFJLFdBQVcsWUFBQSxDQUFBO0FBQ2YsTUFBSSxPQUFPLFlBQUEsQ0FBQTs7QUFFWCxZQUFVLENBQUMsWUFBTTtBQUNmLGVBQVcsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFBO0FBQ3pCLFdBQU8sT0FBTyxDQUFDLFlBQVksQ0FBQTtBQUMzQixXQUFPLEdBQUc7QUFDUixjQUFRLEVBQUUsT0FBTyxDQUFDLFFBQVE7QUFDMUIsU0FBRyxFQUFFLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUM7S0FDcEMsQ0FBQTtHQUNGLENBQUMsQ0FBQTs7QUFFRixXQUFTLENBQUMsWUFBTTtBQUNkLFdBQU8sQ0FBQyxHQUFHLEdBQUcsV0FBVyxDQUFBO0FBQ3pCLFdBQU8sT0FBTyxDQUFDLFlBQVksQ0FBQTtHQUM1QixDQUFDLENBQUE7O0FBRUYsVUFBUSxDQUFDLDZCQUE2QixFQUFFLFlBQU07QUFDNUMsY0FBVSxDQUFDLFlBQU07QUFDZixhQUFPLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQTtLQUM1QixDQUFDLENBQUE7O0FBRUYsWUFBUSxDQUFDLGVBQWUsRUFBRSxZQUFNO0FBQzlCLFFBQUUsQ0FBQyw4QkFBOEIsRUFBRSxZQUFNO0FBQ3ZDLGVBQU8sT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUE7QUFDdEIsY0FBTSxDQUFDLG1DQUFtQixhQUFhLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUE7QUFDNUQsZUFBTyxD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QUFTLENBQUMsT0FBTyxDQUFDLENBQUE7QUFDckMsY0FBTSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQTtBQUNqQyxjQUFNLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDLGFBQWEsRUFBRSxDQUFBO09BQzdDLENBQUMsQ0FBQTtLQUNILENBQUMsQ0FBQTtHQUNILENBQUMsQ0FBQTtDQUNILENBQUMsQ0FBQSIsImZpbGUiOiIvVXNlcnMvc3N1bi8uYXRvbS9wYWNrYWdlcy9lbnZpcm9ubWVudC9zcGVjL2Vudmlyb25tZW50LWhlbHBlcnMtc3BlYy5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2UgYmFiZWwnXG4vKiBlc2xpbnQtZW52IGphc21pbmUgKi9cblxuaW1wb3J0IGNoaWxkX3Byb2Nlc3MgZnJvbSAnY2hpbGRfcHJvY2VzcydcbmltcG9ydCBlbnZpcm9ubWVudEhlbHBlcnMgZnJvbSAnLi4vbGliL2Vudmlyb25tZW50LWhlbHBlcnMnXG5pbXBvcnQgb3MgZnJvbSAnb3MnXG5cbmRlc2NyaWJlKCdFbnZpcm9ubWVudCBoYW5kbGluZycsICgpID0+IHtcbiAgbGV0IG9yaWdpbmFsRW52XG4gIGxldCBvcHRpb25zXG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgb3JpZ2luYWxFbnYgPSBwcm9jZXNzLmVudlxuICAgIGRlbGV0ZSBwcm9jZXNzLl9vcmlnaW5hbEVudlxuICAgIG9wdGlvbnMgPSB7XG4gICAgICBwbGF0Zm9ybTogcHJvY2Vzcy5wbGF0Zm9ybSxcbiAgICAgIGVudjogT2JqZWN0LmFzc2lnbih7fSwgcHJvY2Vzcy5lbnYpXG4gICAgfVxuICB9KVxuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgcHJvY2Vzcy5lbnYgPSBvcmlnaW5hbEVudlxuICAgIGRlbGV0ZSBwcm9jZXNzLl9vcmlnaW5hbEVudlxuICB9KVxuXG4gIGRlc2NyaWJlKCdvbiBPU1gsIHdoZW4gUFdEIGlzIG5vdCBzZXQnLCAoKSA9PiB7XG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBvcHRpb25zLnBsYXRmb3JtID0gJ2RhcndpbidcbiAgICB9KVxuXG4gICAgZGVzY3JpYmUoJ25lZWRzUGF0Y2hpbmcnLCAoKSA9PiB7XG4gICAgICBpdCgncmV0dXJucyB0cnVlIGlmIFBXRCBpcyB1bnNldCcsICgpID0+IHtcbiAgICAgICAgZGVsZXRlIG9wdGlvbnMuZW52LlBXRFxuICAgICAgICBleHBlY3QoZW52aXJvbm1lbnRIZWxwZXJzLm5lZWRzUGF0Y2hpbmcob3B0aW9ucykpLnRvQmUodHJ1ZSlcbiAgICAgICAgb3B0aW9ucy5lbnYuUFdEID0gdW5kZWZpbmVkXG4gICAgICAgIGV4cGVjdChlbnZpcm9ubWVudEhlbHBlcnMubmVlZHNQYXRjaGluZyhvcHRpb25zKSkudG9CZSh0cnVlKVxuICAgICAgICBvcHRpb25zLmVudi5QV0QgPSBudWxsXG4gICAgICAgIGV4cGVjdChlbnZpcm9ubWVudEhlbHBlcnMubmVlZHNQYXRjaGluZyhvcHRpb25zKSkudG9CZSh0cnVlKVxuICAgICAgICBvcHRpb25zLmVudi5QV0QgPSBmYWxzZVxuICAgICAgICBleHBlY3QoZW52aXJvbm1lbnRIZWxwZXJzLm5lZWRzUGF0Y2hpbmcob3B0aW9ucykpLnRvQmUodHJ1ZSlcbiAgICAgIH0pXG5cbiAgICAgIGl0KCdyZXR1cm5zIGZhbHNlIGlmIFBXRCBpcyBzZXQnLCAoKSA9PiB7XG4gICAgICAgIG9wdGlvbnMuZW52LlBXRCA9ICd4dGVybSdcbiAgICAgICAgZXhwZWN0KGVudmlyb25tZW50SGVscGVycy5uZWVkc1BhdGNoaW5nKG9wdGlvbnMpKS50b0JlKGZhbHNlKVxuICAgICAgfSlcbiAgICB9KVxuXG4gICAgZGVzY3JpYmUoJ25vcm1hbGl6ZScsICgpID0+IHtcbiAgICAgIGl0KCdjaGFuZ2VzIHByb2Nlc3MuZW52IGlmIFBXRCBpcyB1bnNldCcsICgpID0+IHtcbiAgICAgICAgaWYgKHByb2Nlc3MucGxhdGZvcm0gPT09ICd3aW4zMicpIHtcbiAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuICAgICAgICBkZWxldGUgb3B0aW9ucy5lbnYuUFdEXG4gICAgICAgIGVudmlyb25tZW50SGVscGVycy5ub3JtYWxpemUob3B0aW9ucylcbiAgICAgICAgZXhwZWN0KHByb2Nlc3MuX29yaWdpbmFsRW52KS50b0JlRGVmaW5lZCgpXG4gICAgICAgIGV4cGVjdChwcm9jZXNzLl9vcmlnaW5hbEVudikudG9CZVRydXRoeSgpXG4gICAgICAgIGV4cGVjdChwcm9jZXNzLmVudikudG9CZURlZmluZWQoKVxuICAgICAgICBleHBlY3QocHJvY2Vzcy5lbnYpLnRvQmVUcnV0aHkoKVxuICAgICAgICBleHBlY3QocHJvY2Vzcy5lbnYuUFdEKS50b0JlRGVmaW5lZCgpXG4gICAgICAgIGV4cGVjdChwcm9jZXNzLmVudi5QV0QpLnRvQmVUcnV0aHkoKVxuICAgICAgICBleHBlY3QocHJvY2Vzcy5lbnYuUEFUSCkudG9CZURlZmluZWQoKVxuICAgICAgICBleHBlY3QocHJvY2Vzcy5lbnYuUEFUSCkudG9CZVRydXRoeSgpXG4gICAgICAgIGV4cGVjdChwcm9jZXNzLmVudi5BVE9NX0hPTUUpLnRvQmVEZWZpbmVkKClcbiAgICAgICAgZXhwZWN0KHByb2Nlc3MuZW52LkFUT01fSE9NRSkudG9CZVRydXRoeSgpXG4gICAgICB9KVxuICAgIH0pXG4gIH0pXG5cbiAgZGVzY3JpYmUoJ29uIGEgcGxhdGZvcm0gb3RoZXIgdGhhbiBPU1gnLCAoKSA9PiB7XG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBvcHRpb25zLnBsYXRmb3JtID0gJ3Blbmd1aW4nXG4gICAgfSlcblxuICAgIGRlc2NyaWJlKCduZWVkc1BhdGNoaW5nJywgKCkgPT4ge1xuICAgICAgaXQoJ3JldHVybnMgZmFsc2UgaWYgUFdEIGlzIHNldCBvciB1bnNldCcsICgpID0+IHtcbiAgICAgICAgZGVsZXRlIG9wdGlvbnMuZW52LlBXRFxuICAgICAgICBleHBlY3QoZW52aXJvbm1lbnRIZWxwZXJzLm5lZWRzUGF0Y2hpbmcob3B0aW9ucykpLnRvQmUoZmFsc2UpXG4gICAgICAgIG9wdGlvbnMuZW52LlBXRCA9IHVuZGVmaW5lZFxuICAgICAgICBleHBlY3QoZW52aXJvbm1lbnRIZWxwZXJzLm5lZWRzUGF0Y2hpbmcob3B0aW9ucykpLnRvQmUoZmFsc2UpXG4gICAgICAgIG9wdGlvbnMuZW52LlBXRCA9IG51bGxcbiAgICAgICAgZXhwZWN0KGVudmlyb25tZW50SGVscGVycy5uZWVkc1BhdGNoaW5nKG9wdGlvbnMpKS50b0JlKGZhbHNlKVxuICAgICAgICBvcHRpb25zLmVudi5QV0QgPSBmYWxzZVxuICAgICAgICBleHBlY3QoZW52aXJvbm1lbnRIZWxwZXJzLm5lZWRzUGF0Y2hpbmcob3B0aW9ucykpLnRvQmUoZmFsc2UpXG4gICAgICAgIG9wdGlvbnMuZW52LlBXRCA9ICcvJ1xuICAgICAgICBleHBlY3QoZW52aXJvbm1lbnRIZWxwZXJzLm5lZWRzUGF0Y2hpbmcob3B0aW9ucykpLnRvQmUoZmFsc2UpXG4gICAgICB9KVxuXG4gICAgICBpdCgncmV0dXJucyBmYWxzZSBmb3IgbGludXgnLCAoKSA9PiB7XG4gICAgICAgIG9wdGlvbnMucGxhdGZvcm0gPSAnbGludXgnXG4gICAgICAgIG9wdGlvbnMuUFdEID0gJy8nXG4gICAgICAgIGV4cGVjdChlbnZpcm9ubWVudEhlbHBlcnMubmVlZHNQYXRjaGluZyhvcHRpb25zKSkudG9CZShmYWxzZSlcbiAgICAgIH0pXG5cbiAgICAgIGl0KCdyZXR1cm5zIGZhbHNlIGZvciB3aW5kb3dzJywgKCkgPT4ge1xuICAgICAgICBvcHRpb25zLnBsYXRmb3JtID0gJ3dpbjMyJ1xuICAgICAgICBvcHRpb25zLlBXRCA9ICdjOlxcXFwnXG4gICAgICAgIGV4cGVjdChlbnZpcm9ubWVudEhlbHBlcnMubmVlZHNQYXRjaGluZyhvcHRpb25zKSkudG9CZShmYWxzZSlcbiAgICAgIH0pXG4gICAgfSlcblxuICAgIGRlc2NyaWJlKCdub3JtYWxpemUnLCAoKSA9PiB7XG4gICAgICBpdCgnZG9lcyBub3QgY2hhbmdlIHRoZSBlbnZpcm9ubWVudCcsICgpID0+IHtcbiAgICAgICAgaWYgKHByb2Nlc3MucGxhdGZvcm0gPT09ICd3aW4zMicpIHtcbiAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuICAgICAgICBkZWxldGUgb3B0aW9ucy5lbnYuUFdEXG4gICAgICAgIGVudmlyb25tZW50SGVscGVycy5ub3JtYWxpemUob3B0aW9ucylcbiAgICAgICAgZXhwZWN0KHByb2Nlc3MuX29yaWdpbmFsRW52KS50b0JlVW5kZWZpbmVkKClcbiAgICAgICAgZXhwZWN0KHByb2Nlc3MuZW52KS50b0JlRGVmaW5lZCgpXG4gICAgICAgIGV4cGVjdChwcm9jZXNzLmVudikudG9CZVRydXRoeSgpXG4gICAgICAgIGV4cGVjdChwcm9jZXNzLmVudi5QQVRIKS50b0JlRGVmaW5lZCgpXG4gICAgICAgIGV4cGVjdChwcm9jZXNzLmVudi5QQVRIKS50b0JlVHJ1dGh5KClcbiAgICAgICAgZXhwZWN0KHByb2Nlc3MuZW52LlBXRCkudG9CZVVuZGVmaW5lZCgpXG4gICAgICAgIGV4cGVjdChwcm9jZXNzLmVudi5QQVRIKS50b0JlKG9yaWdpbmFsRW52LlBBVEgpXG4gICAgICAgIGV4cGVjdChwcm9jZXNzLmVudi5BVE9NX0hPTUUpLnRvQmVEZWZpbmVkKClcbiAgICAgICAgZXhwZWN0KHByb2Nlc3MuZW52LkFUT01fSE9NRSkudG9CZVRydXRoeSgpXG4gICAgICB9KVxuICAgIH0pXG4gIH0pXG5cbiAgZGVzY3JpYmUoJ2dldEZyb21TaGVsbCcsICgpID0+IHtcbiAgICBkZXNjcmliZSgnd2hlbiB0aGluZ3MgYXJlIGNvbmZpZ3VyZWQgcHJvcGVybHknLCAoKSA9PiB7XG4gICAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgICAgc3B5T24oY2hpbGRfcHJvY2VzcywgJ3NwYXduU3luYycpLmFuZFJldHVybih7XG4gICAgICAgICAgc3Rkb3V0OiAnRk9PPUJBUicgKyBvcy5FT0wgKyAnVEVSTT14dGVybS1zb21ldGhpbmcnICsgb3MuRU9MICtcbiAgICAgICAgICAgICAgICAgICdQQVRIPS91c3IvYmluOi9iaW46L3Vzci9zYmluOi9zYmluOi9jcmF6eS9wYXRoJ1xuICAgICAgICB9KVxuICAgICAgfSlcblxuICAgICAgaXQoJ3JldHVybnMgYW4gb2JqZWN0IGNvbnRhaW5pbmcgdGhlIGluZm9ybWF0aW9uIGZyb20gdGhlIHVzZXJcXCdzIHNoZWxsIGVudmlyb25tZW50JywgKCkgPT4ge1xuICAgICAgICBsZXQgZW52ID0gZW52aXJvbm1lbnRIZWxwZXJzLmdldEZyb21TaGVsbCgpXG4gICAgICAgIGV4cGVjdChlbnYuRk9PKS50b0VxdWFsKCdCQVInKVxuICAgICAgICBleHBlY3QoZW52LlRFUk0pLnRvRXF1YWwoJ3h0ZXJtLXNvbWV0aGluZycpXG4gICAgICAgIGV4cGVjdChlbnYuUEFUSCkudG9FcXVhbCgnL3Vzci9iaW46L2JpbjovdXNyL3NiaW46L3NiaW46L2NyYXp5L3BhdGgnKVxuICAgICAgfSlcbiAgICB9KVxuXG4gICAgZGVzY3JpYmUoJ3doZW4gYW4gZXJyb3Igb2NjdXJzIGxhdW5jaGluZyB0aGUgc2hlbGwnLCAoKSA9PiB7XG4gICAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgICAgc3B5T24oY2hpbGRfcHJvY2VzcywgJ3NwYXduU3luYycpLmFuZFJldHVybih7XG4gICAgICAgICAgZXJyb3I6IG5ldyBFcnJvcigndGVzdGluZyB3aGVuIGFuIGVycm9yIG9jY3VycycpXG4gICAgICAgIH0pXG4gICAgICB9KVxuXG4gICAgICBpdCgncmV0dXJucyB1bmRlZmluZWQnLCAoKSA9PiB7XG4gICAgICAgIGV4cGVjdChlbnZpcm9ubWVudEhlbHBlcnMuZ2V0RnJvbVNoZWxsKCkpLnRvQmVVbmRlZmluZWQoKVxuICAgICAgfSlcblxuICAgICAgaXQoJ2xlYXZlcyB0aGUgZW52aXJvbm1lbnQgYXMtaXMgd2hlbiBub3JtYWxpemUoKSBpcyBjYWxsZWQnLCAoKSA9PiB7XG4gICAgICAgIG9wdGlvbnMucGxhdGZvcm0gPSAnZGFyd2luJ1xuICAgICAgICBkZWxldGUgb3B0aW9ucy5lbnYuUFdEXG4gICAgICAgIGV4cGVjdChlbnZpcm9ubWVudEhlbHBlcnMubmVlZHNQYXRjaGluZyhvcHRpb25zKSkudG9CZSh0cnVlKVxuICAgICAgICBlbnZpcm9ubWVudEhlbHBlcnMubm9ybWFsaXplKG9wdGlvbnMpXG4gICAgICAgIGV4cGVjdChwcm9jZXNzLmVudikudG9CZURlZmluZWQoKVxuICAgICAgICBleHBlY3QocHJvY2Vzcy5fb3JpZ2luYWxFbnYpLnRvQmVVbmRlZmluZWQoKVxuICAgICAgfSlcbiAgICB9KVxuICB9KVxufSlcbiJdfQ==
//# sourceURL=/Users/ssun/.atom/packages/environment/spec/environment-helpers-spec.js
