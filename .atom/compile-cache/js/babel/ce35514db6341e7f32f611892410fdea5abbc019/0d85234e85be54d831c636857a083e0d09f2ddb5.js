Object.defineProperty(exports, '__esModule', {
  value: true
});
exports.init = init;
exports.dispose = dispose;

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj['default'] = obj; return newObj; } }

var _atom = require('atom');

var _store = require('./store');

var _delve = require('./delve');

var Delve = _interopRequireWildcard(_delve);

var _utils = require('./utils');

'use babel';

var editors = new Map();

function observeTextEditors(editor) {
  var grammar = editor.getGrammar();
  if (grammar.scopeName !== 'source.go') {
    return;
  }
  if (editors.has(editor)) {
    // update the editor
    updateMarkers(editor);
    return;
  }

  var o = {
    markers: [], // contains the breakpoint markers
    gutter: editor.addGutter({ name: 'go-debug', priority: -100 })
  };
  editors.set(editor, o);

  updateMarkers(editor);

  var gutterView = atom.views.getView(o.gutter);
  gutterView.addEventListener('click', onGutterClick.bind(null, editor));
}

function onWillDestroyPaneItem(_ref) {
  var editor = _ref.item;

  var file = editor && editor.getPath && editor.getPath();
  if (file) {
    destroyEditor(editors.get(editor));
    editors['delete'](editor);
  }
}

var lastStackPC = undefined;

var lineMarker = undefined;
var removeLineMarker = function removeLineMarker() {
  return lineMarker && lineMarker.destroy();
};

function openAndHighlight(stack) {
  if (!stack) {
    // finished or just started -> no line marker visible
    removeLineMarker();
    lastStackPC = 0;
    return;
  }

  if (stack.pc === lastStackPC) {
    return;
  }
  lastStackPC = stack.pc;

  // remove any previous line marker
  removeLineMarker();

  // open the file
  var line = stack.line - 1; // dlv = 1 indexed line / atom = 0 indexed line
  atom.workspace.open(stack.file, { initialLine: line, searchAllPanes: true }).then(function () {
    // create a new marker
    var editor = atom.workspace.getActiveTextEditor();
    lineMarker = editor.markBufferPosition({ row: line });
    editor.decorateMarker(lineMarker, { type: 'line', 'class': 'go-debug-debug-line' });

    // center the line
    editor.scrollToBufferPosition([line, 0], { center: true });
  });
}

function updateMarkers(editor) {
  var bps = (0, _store.getBreakpoints)(editor && editor.getPath());

  // update and add markers
  bps.forEach(function (bp) {
    return updateMarker(editor, bp.file, bp.line, bp);
  });

  // remove remaining
  var file = editor.getPath();
  var editorBps = editors.get(editor).markers;
  editorBps.forEach(function (_ref2) {
    var line = _ref2.line;

    if ((0, _store.indexOfBreakpoint)(bps, file, line) === -1) {
      updateMarker(editor, file, line);
    }
  });
}

function updateMarker(editor, file, line, bp) {
  var o = editors.get(editor);
  if (!o) {
    return; // editor not visible, nothing to show
  }

  var index = o.markers.findIndex(function (_ref3) {
    var l = _ref3.line;
    return l === line;
  });
  var marker = o.markers[index];
  if (!bp) {
    if (marker) {
      marker.decoration.getMarker().destroy();
    }
    o.markers.splice(index, 1);
    return;
  }

  var el = document.createElement('div');
  el.className = 'go-debug-breakpoint go-debug-breakpoint-state-' + bp.state;
  el.dataset.state = bp.state;
  el.title = bp.message || ''; // TODO: add texts for other breakpoint states
  var decoration = {
    'class': 'go-debug-gutter-breakpoint',
    item: el
  };

  if (!marker) {
    // create a new decoration
    var _marker = editor.markBufferPosition({ row: line });
    _marker.onDidChange((0, _utils.debounce)(onMarkerDidChange.bind(null, { file: file, line: line, marker: _marker }), 50));
    o.markers.push({
      marker: _marker,
      line: line,
      bp: bp,
      decoration: o.gutter.decorateMarker(_marker, decoration)
    });
  } else {
    // check if the breakpoint has even changed
    if (marker.bp === bp) {
      return;
    }
    marker.bp = bp;

    // update an existing decoration
    marker.decoration.setProperties(Object.assign({}, marker.decoration.getProperties(), decoration));
  }
}

function onMarkerDidChange(_ref4, event) {
  var file = _ref4.file;
  var line = _ref4.line;
  var marker = _ref4.marker;

  if (!event.isValid) {
    // marker is not valid anymore - text at marker got
    // replaced or was removed -> remove the breakpoint
    Delve.removeBreakpoint(file, line);
    return;
  }

  Delve.updateBreakpointLine(file, line, marker.getStartBufferPosition().row);
}

var debouncedStoreChange = (0, _utils.debounce)(function () {
  editors.forEach(function (o, editor) {
    return updateMarkers(editor);
  });

  // open the file of the selected stacktrace and highlight the current line
  var state = _store.store.getState();
  openAndHighlight(state.delve.stacktrace[state.delve.selectedStacktrace]);
}, 50);

var subscriptions = undefined;

function init() {
  subscriptions = new _atom.CompositeDisposable(atom.workspace.observeTextEditors(observeTextEditors), atom.workspace.onWillDestroyPaneItem(onWillDestroyPaneItem), { dispose: _store.store.subscribe(debouncedStoreChange) });
}

function dispose() {
  editors.forEach(destroyEditor);
  editors.clear();

  removeLineMarker();
  lineMarker = null;

  subscriptions.dispose();
  subscriptions = null;
}

function destroyEditor(o) {
  if (!o) {
    return;
  }

  try {
    o.gutter.destroy();
  } catch (e) {
    console.warn('go-debug', e);
  }

  // remove all breakpoint decorations (marker)
  o.markers.forEach(function (bp) {
    return bp.decoration.getMarker().destroy();
  });
}

function onGutterClick(editor, ev) {
  var editorView = atom.views.getView(editor);

  var _editorView$component$screenPositionForMouseEvent = editorView.component.screenPositionForMouseEvent(ev);

  var line = _editorView$component$screenPositionForMouseEvent.row;

  line = editor.bufferRowForScreenRow(line);

  // TODO: conditions via right click menu?

  var file = editor.getPath();
  var o = editors.get(editor);
  var deco = o.markers.find(function (_ref5) {
    var l = _ref5.line;
    return l === line;
  });
  if (deco) {
    Delve.removeBreakpoint(file, line);
    return;
  }

  Delve.addBreakpoint(file, line);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9zc3VuLy5hdG9tL3BhY2thZ2VzL2dvLWRlYnVnL2xpYi9lZGl0b3JzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O29CQUVvQyxNQUFNOztxQkFDZSxTQUFTOztxQkFDM0MsU0FBUzs7SUFBcEIsS0FBSzs7cUJBQ1EsU0FBUzs7QUFMbEMsV0FBVyxDQUFBOztBQU9YLElBQU0sT0FBTyxHQUFHLElBQUksR0FBRyxFQUFFLENBQUE7O0FBRXpCLFNBQVMsa0JBQWtCLENBQUUsTUFBTSxFQUFFO0FBQ25DLE1BQU0sT0FBTyxHQUFHLE1BQU0sQ0FBQyxVQUFVLEVBQUUsQ0FBQTtBQUNuQyxNQUFJLE9BQU8sQ0FBQyxTQUFTLEtBQUssV0FBVyxFQUFFO0FBQ3JDLFdBQU07R0FDUDtBQUNELE1BQUksT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRTs7QUFFdkIsaUJBQWEsQ0FBQyxNQUFNLENBQUMsQ0FBQTtBQUNyQixXQUFNO0dBQ1A7O0FBRUQsTUFBTSxDQUFDLEdBQUc7QUFDUixXQUFPLEVBQUUsRUFBRTtBQUNYLFVBQU0sRUFBRSxNQUFNLENBQUMsU0FBUyxDQUFDLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQztHQUMvRCxDQUFBO0FBQ0QsU0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUE7O0FBRXRCLGVBQWEsQ0FBQyxNQUFNLENBQUMsQ0FBQTs7QUFFckIsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFBO0FBQy9DLFlBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQTtDQUN2RTs7QUFFRCxTQUFTLHFCQUFxQixDQUFFLElBQWdCLEVBQUU7TUFBVixNQUFNLEdB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U0FBUyxFQUFFLENBQUMsT0FBTyxFQUFFO0dBQUEsQ0FBQyxDQUFBO0NBQy9EOztBQUVELFNBQVMsYUFBYSxDQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUU7QUFDbEMsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUE7OzBEQUN6QixVQUFVLENBQUMsU0FBUyxDQUFDLDJCQUEyQixDQUFDLEVBQUUsQ0FBQzs7TUFBN0QsSUFBSSxxREFBVCxHQUFHOztBQUNULE1BQUksR0FBRyxNQUFNLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLENBQUE7Ozs7QUFJekMsTUFBTSxJQUFJLEdBQUcsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFBO0FBQzdCLE1BQU0sQ0FBQyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUE7QUFDN0IsTUFBTSxJQUFJLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsVUFBQyxLQUFXO1FBQUgsQ0FBQyxHQUFULEtBQVcsQ0FBVCxJQUFJO1dBQVUsQ0FBQyxLQUFLLElBQUk7R0FBQSxDQUFDLENBQUE7QUFDeEQsTUFBSSxJQUFJLEVBQUU7QUFDUixTQUFLLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFBO0FBQ2xDLFdBQU07R0FDUDs7QUFFRCxPQUFLLENBQUMsYUFBYSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQTtDQUNoQyIsImZpbGUiOiIvVXNlcnMvc3N1bi8uYXRvbS9wYWNrYWdlcy9nby1kZWJ1Zy9saWIvZWRpdG9ycy5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2UgYmFiZWwnXG5cbmltcG9ydCB7IENvbXBvc2l0ZURpc3Bvc2FibGUgfSBmcm9tICdhdG9tJ1xuaW1wb3J0IHsgc3RvcmUsIGluZGV4T2ZCcmVha3BvaW50LCBnZXRCcmVha3BvaW50cyB9IGZyb20gJy4vc3RvcmUnXG5pbXBvcnQgKiBhcyBEZWx2ZSBmcm9tICcuL2RlbHZlJ1xuaW1wb3J0IHsgZGVib3VuY2UgfSBmcm9tICcuL3V0aWxzJ1xuXG5jb25zdCBlZGl0b3JzID0gbmV3IE1hcCgpXG5cbmZ1bmN0aW9uIG9ic2VydmVUZXh0RWRpdG9ycyAoZWRpdG9yKSB7XG4gIGNvbnN0IGdyYW1tYXIgPSBlZGl0b3IuZ2V0R3JhbW1hcigpXG4gIGlmIChncmFtbWFyLnNjb3BlTmFtZSAhPT0gJ3NvdXJjZS5nbycpIHtcbiAgICByZXR1cm5cbiAgfVxuICBpZiAoZWRpdG9ycy5oYXMoZWRpdG9yKSkge1xuICAgIC8vIHVwZGF0ZSB0aGUgZWRpdG9yXG4gICAgdXBkYXRlTWFya2VycyhlZGl0b3IpXG4gICAgcmV0dXJuXG4gIH1cblxuICBjb25zdCBvID0ge1xuICAgIG1hcmtlcnM6IFtdLCAvLyBjb250YWlucyB0aGUgYnJlYWtwb2ludCBtYXJrZXJzXG4gICAgZ3V0dGVyOiBlZGl0b3IuYWRkR3V0dGVyKHsgbmFtZTogJ2dvLWRlYnVnJywgcHJpb3JpdHk6IC0xMDAgfSlcbiAgfVxuICBlZGl0b3JzLnNldChlZGl0b3IsIG8pXG5cbiAgdXBkYXRlTWFya2VycyhlZGl0b3IpXG5cbiAgY29uc3QgZ3V0dGVyVmlldyA9IGF0b20udmlld3MuZ2V0VmlldyhvLmd1dHRlcilcbiAgZ3V0dGVyVmlldy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uR3V0dGVyQ2xpY2suYmluZChudWxsLCBlZGl0b3IpKVxufVxuXG5mdW5jdGlvbiBvbldpbGxEZXN0cm95UGFuZUl0ZW0gKHsgaXRlbTogZWRpdG9yIH0pIHtcbiAgY29uc3QgZmlsZSA9IGVkaXRvciAmJiBlZGl0b3IuZ2V0UGF0aCAmJiBlZGl0b3IuZ2V0UGF0aCgpXG4gIGlmIChmaWxlKSB7XG4gICAgZGVzdHJveUVkaXRvcihlZGl0b3JzLmdldChlZGl0b3IpKVxuICAgIGVkaXRvcnMuZGVsZXRlKGVkaXRvcilcbiAgfVxufVxuXG5sZXQgbGFzdFN0YWNrUENcblxubGV0IGxpbmVNYXJrZXJcbmNvbnN0IHJlbW92ZUxpbmVNYXJrZXIgPSAoKSA9PiBsaW5lTWFya2VyICYmIGxpbmVNYXJrZXIuZGVzdHJveSgpXG5cbmZ1bmN0aW9uIG9wZW5BbmRIaWdobGlnaHQgKHN0YWNrKSB7XG4gIGlmICghc3RhY2spIHtcbiAgICAvLyBmaW5pc2hlZCBvciBqdXN0IHN0YXJ0ZWQgLT4gbm8gbGluZSBtYXJrZXIgdmlzaWJsZVxuICAgIHJlbW92ZUxpbmVNYXJrZXIoKVxuICAgIGxhc3RTdGFja1BDID0gMFxuICAgIHJldHVyblxuICB9XG5cbiAgaWYgKHN0YWNrLnBjID09PSBsYXN0U3RhY2tQQykge1xuICAgIHJldHVyblxuICB9XG4gIGxhc3RTdGFja1BDID0gc3RhY2sucGNcblxuICAvLyByZW1vdmUgYW55IHByZXZpb3VzIGxpbmUgbWFya2VyXG4gIHJlbW92ZUxpbmVNYXJrZXIoKVxuXG4gIC8vIG9wZW4gdGhlIGZpbGVcbiAgY29uc3QgbGluZSA9IHN0YWNrLmxpbmUgLSAxIC8vIGRsdiA9IDEgaW5kZXhlZCBsaW5lIC8gYXRvbSA9IDAgaW5kZXhlZCBsaW5lXG4gIGF0b20ud29ya3NwYWNlLm9wZW4oc3RhY2suZmlsZSwgeyBpbml0aWFsTGluZTogbGluZSwgc2VhcmNoQWxsUGFuZXM6IHRydWUgfSkudGhlbigoKSA9PiB7XG4gICAgLy8gY3JlYXRlIGEgbmV3IG1hcmtlclxuICAgIGNvbnN0IGVkaXRvciA9IGF0b20ud29ya3NwYWNlLmdldEFjdGl2ZVRleHRFZGl0b3IoKVxuICAgIGxpbmVNYXJrZXIgPSBlZGl0b3IubWFya0J1ZmZlclBvc2l0aW9uKHsgcm93OiBsaW5lIH0pXG4gICAgZWRpdG9yLmRlY29yYXRlTWFya2VyKGxpbmVNYXJrZXIsIHsgdHlwZTogJ2xpbmUnLCBjbGFzczogJ2dvLWRlYnVnLWRlYnVnLWxpbmUnIH0pXG5cbiAgICAvLyBjZW50ZXIgdGhlIGxpbmVcbiAgICBlZGl0b3Iuc2Nyb2xsVG9CdWZmZXJQb3NpdGlvbihbbGluZSwgMF0sIHsgY2VudGVyOiB0cnVlIH0pXG4gIH0pXG59XG5cbmZ1bmN0aW9uIHVwZGF0ZU1hcmtlcnMgKGVkaXRvcikge1xuICBjb25zdCBicHMgPSBnZXRCcmVha3BvaW50cyhlZGl0b3IgJiYgZWRpdG9yLmdldFBhdGgoKSlcblxuICAvLyB1cGRhdGUgYW5kIGFkZCBtYXJrZXJzXG4gIGJwcy5mb3JFYWNoKChicCkgPT4gdXBkYXRlTWFya2VyKGVkaXRvciwgYnAuZmlsZSwgYnAubGluZSwgYnApKVxuXG4gIC8vIHJlbW92ZSByZW1haW5pbmdcbiAgY29uc3QgZmlsZSA9IGVkaXRvci5nZXRQYXRoKClcbiAgY29uc3QgZWRpdG9yQnBzID0gZWRpdG9ycy5nZXQoZWRpdG9yKS5tYXJrZXJzXG4gIGVkaXRvckJwcy5mb3JFYWNoKCh7IGxpbmUgfSkgPT4ge1xuICAgIGlmIChpbmRleE9mQnJlYWtwb2ludChicHMsIGZpbGUsIGxpbmUpID09PSAtMSkge1xuICAgICAgdXBkYXRlTWFya2VyKGVkaXRvciwgZmlsZSwgbGluZSlcbiAgICB9XG4gIH0pXG59XG5cbmZ1bmN0aW9uIHVwZGF0ZU1hcmtlciAoZWRpdG9yLCBmaWxlLCBsaW5lLCBicCkge1xuICBjb25zdCBvID0gZWRpdG9ycy5nZXQoZWRpdG9yKVxuICBpZiAoIW8pIHtcbiAgICByZXR1cm4gLy8gZWRpdG9yIG5vdCB2aXNpYmxlLCBub3RoaW5nIHRvIHNob3dcbiAgfVxuXG4gIGNvbnN0IGluZGV4ID0gby5tYXJrZXJzLmZpbmRJbmRleCgoeyBsaW5lOiBsIH0pID0+IGwgPT09IGxpbmUpXG4gIGNvbnN0IG1hcmtlciA9IG8ubWFya2Vyc1tpbmRleF1cbiAgaWYgKCFicCkge1xuICAgIGlmIChtYXJrZXIpIHtcbiAgICAgIG1hcmtlci5kZWNvcmF0aW9uLmdldE1hcmtlcigpLmRlc3Ryb3koKVxuICAgIH1cbiAgICBvLm1hcmtlcnMuc3BsaWNlKGluZGV4LCAxKVxuICAgIHJldHVyblxuICB9XG5cbiAgY29uc3QgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKVxuICBlbC5jbGFzc05hbWUgPSAnZ28tZGVidWctYnJlYWtwb2ludCBnby1kZWJ1Zy1icmVha3BvaW50LXN0YXRlLScgKyBicC5zdGF0ZVxuICBlbC5kYXRhc2V0LnN0YXRlID0gYnAuc3RhdGVcbiAgZWwudGl0bGUgPSBicC5tZXNzYWdlIHx8ICcnIC8vIFRPRE86IGFkZCB0ZXh0cyBmb3Igb3RoZXIgYnJlYWtwb2ludCBzdGF0ZXNcbiAgY29uc3QgZGVjb3JhdGlvbiA9IHtcbiAgICBjbGFzczogJ2dvLWRlYnVnLWd1dHRlci1icmVha3BvaW50JyxcbiAgICBpdGVtOiBlbFxuICB9XG5cbiAgaWYgKCFtYXJrZXIpIHtcbiAgICAvLyBjcmVhdGUgYSBuZXcgZGVjb3JhdGlvblxuICAgIGNvbnN0IG1hcmtlciA9IGVkaXRvci5tYXJrQnVmZmVyUG9zaXRpb24oeyByb3c6IGxpbmUgfSlcbiAgICBtYXJrZXIub25EaWRDaGFuZ2UoZGVib3VuY2Uob25NYXJrZXJEaWRDaGFuZ2UuYmluZChudWxsLCB7IGZpbGUsIGxpbmUsIG1hcmtlciB9KSwgNTApKVxuICAgIG8ubWFya2Vycy5wdXNoKHtcbiAgICAgIG1hcmtlcixcbiAgICAgIGxpbmUsXG4gICAgICBicCxcbiAgICAgIGRlY29yYXRpb246IG8uZ3V0dGVyLmRlY29yYXRlTWFya2VyKG1hcmtlciwgZGVjb3JhdGlvbilcbiAgICB9KVxuICB9IGVsc2Uge1xuICAgIC8vIGNoZWNrIGlmIHRoZSBicmVha3BvaW50IGhhcyBldmVuIGNoYW5nZWRcbiAgICBpZiAobWFya2VyLmJwID09PSBicCkge1xuICAgICAgcmV0dXJuXG4gICAgfVxuICAgIG1hcmtlci5icCA9IGJwXG5cbiAgICAvLyB1cGRhdGUgYW4gZXhpc3RpbmcgZGVjb3JhdGlvblxuICAgIG1hcmtlci5kZWNvcmF0aW9uLnNldFByb3BlcnRpZXMoT2JqZWN0LmFzc2lnbihcbiAgICAgIHt9LFxuICAgICAgbWFya2VyLmRlY29yYXRpb24uZ2V0UHJvcGVydGllcygpLFxuICAgICAgZGVjb3JhdGlvblxuICAgICkpXG4gIH1cbn1cblxuZnVuY3Rpb24gb25NYXJrZXJEaWRDaGFuZ2UgKHsgZmlsZSwgbGluZSwgbWFya2VyIH0sIGV2ZW50KSB7XG4gIGlmICghZXZlbnQuaXNWYWxpZCkge1xuICAgIC8vIG1hcmtlciBpcyBub3QgdmFsaWQgYW55bW9yZSAtIHRleHQgYXQgbWFya2VyIGdvdFxuICAgIC8vIHJlcGxhY2VkIG9yIHdhcyByZW1vdmVkIC0+IHJlbW92ZSB0aGUgYnJlYWtwb2ludFxuICAgIERlbHZlLnJlbW92ZUJyZWFrcG9pbnQoZmlsZSwgbGluZSlcbiAgICByZXR1cm5cbiAgfVxuXG4gIERlbHZlLnVwZGF0ZUJyZWFrcG9pbnRMaW5lKGZpbGUsIGxpbmUsIG1hcmtlci5nZXRTdGFydEJ1ZmZlclBvc2l0aW9uKCkucm93KVxufVxuXG5jb25zdCBkZWJvdW5jZWRTdG9yZUNoYW5nZSA9IGRlYm91bmNlKCgpID0+IHtcbiAgZWRpdG9ycy5mb3JFYWNoKChvLCBlZGl0b3IpID0+IHVwZGF0ZU1hcmtlcnMoZWRpdG9yKSlcblxuICAvLyBvcGVuIHRoZSBmaWxlIG9mIHRoZSBzZWxlY3RlZCBzdGFja3RyYWNlIGFuZCBoaWdobGlnaHQgdGhlIGN1cnJlbnQgbGluZVxuICBjb25zdCBzdGF0ZSA9IHN0b3JlLmdldFN0YXRlKClcbiAgb3BlbkFuZEhpZ2hsaWdodChzdGF0ZS5kZWx2ZS5zdGFja3RyYWNlW3N0YXRlLmRlbHZlLnNlbGVjdGVkU3RhY2t0cmFjZV0pXG59LCA1MClcblxubGV0IHN1YnNjcmlwdGlvbnNcbmV4cG9ydCBmdW5jdGlvbiBpbml0ICgpIHtcbiAgc3Vic2NyaXB0aW9ucyA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKFxuICAgIGF0b20ud29ya3NwYWNlLm9ic2VydmVUZXh0RWRpdG9ycyhvYnNlcnZlVGV4dEVkaXRvcnMpLFxuICAgIGF0b20ud29ya3NwYWNlLm9uV2lsbERlc3Ryb3lQYW5lSXRlbShvbldpbGxEZXN0cm95UGFuZUl0ZW0pLFxuICAgIHsgZGlzcG9zZTogc3RvcmUuc3Vic2NyaWJlKGRlYm91bmNlZFN0b3JlQ2hhbmdlKSB9XG4gIClcbn1cbmV4cG9ydCBmdW5jdGlvbiBkaXNwb3NlICgpIHtcbiAgZWRpdG9ycy5mb3JFYWNoKGRlc3Ryb3lFZGl0b3IpXG4gIGVkaXRvcnMuY2xlYXIoKVxuXG4gIHJlbW92ZUxpbmVNYXJrZXIoKVxuICBsaW5lTWFya2VyID0gbnVsbFxuXG4gIHN1YnNjcmlwdGlvbnMuZGlzcG9zZSgpXG4gIHN1YnNjcmlwdGlvbnMgPSBudWxsXG59XG5cbmZ1bmN0aW9uIGRlc3Ryb3lFZGl0b3IgKG8pIHtcbiAgaWYgKCFvKSB7XG4gICAgcmV0dXJuXG4gIH1cblxuICB0cnkge1xuICAgIG8uZ3V0dGVyLmRlc3Ryb3koKVxuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc29sZS53YXJuKCdnby1kZWJ1ZycsIGUpXG4gIH1cblxuICAvLyByZW1vdmUgYWxsIGJyZWFrcG9pbnQgZGVjb3JhdGlvbnMgKG1hcmtlcilcbiAgby5tYXJrZXJzLmZvckVhY2goKGJwKSA9PiBicC5kZWNvcmF0aW9uLmdldE1hcmtlcigpLmRlc3Ryb3koKSlcbn1cblxuZnVuY3Rpb24gb25HdXR0ZXJDbGljayAoZWRpdG9yLCBldikge1xuICBjb25zdCBlZGl0b3JWaWV3ID0gYXRvbS52aWV3cy5nZXRWaWV3KGVkaXRvcilcbiAgbGV0IHsgcm93OiBsaW5lIH0gPSBlZGl0b3JWaWV3LmNvbXBvbmVudC5zY3JlZW5Qb3NpdGlvbkZvck1vdXNlRXZlbnQoZXYpXG4gIGxpbmUgPSBlZGl0b3IuYnVmZmVyUm93Rm9yU2NyZWVuUm93KGxpbmUpXG5cbiAgLy8gVE9ETzogY29uZGl0aW9ucyB2aWEgcmlnaHQgY2xpY2sgbWVudT9cblxuICBjb25zdCBmaWxlID0gZWRpdG9yLmdldFBhdGgoKVxuICBjb25zdCBvID0gZWRpdG9ycy5nZXQoZWRpdG9yKVxuICBjb25zdCBkZWNvID0gby5tYXJrZXJzLmZpbmQoKHsgbGluZTogbCB9KSA9PiBsID09PSBsaW5lKVxuICBpZiAoZGVjbykge1xuICAgIERlbHZlLnJlbW92ZUJyZWFrcG9pbnQoZmlsZSwgbGluZSlcbiAgICByZXR1cm5cbiAgfVxuXG4gIERlbHZlLmFkZEJyZWFrcG9pbnQoZmlsZSwgbGluZSlcbn1cbiJdfQ==
//# sourceURL=/Users/ssun/.atom/packages/go-debug/lib/editors.js
